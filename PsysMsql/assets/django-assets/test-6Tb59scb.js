function r(e){e=e||{},this.config={searchInputId:"product-search-input",resultsContainerId:"search-results",selectedProductInputId:"selected-product-id",quantityInputName:"totalsell",searchUrl:e.searchUrl||"/app/search-products-ajax/",minSearchLength:2,debounceTime:300,maxResults:10};for(var t in e)e.hasOwnProperty(t)&&(this.config[t]=e[t]);this.searchTimeout=null,this.currentSelectedIndex=-1,this.availableProducts=[],this.searchInput=document.getElementById(this.config.searchInputId),this.resultsContainer=document.getElementById(this.config.resultsContainerId),this.selectedProductInput=document.getElementById(this.config.selectedProductInputId),this.searchInput&&this.resultsContainer&&this.selectedProductInput&&this.initializeEvents()}r.prototype.initializeEvents=function(){var e=this;this.searchInput.addEventListener("input",function(t){e.handleInput(t)}),this.searchInput.addEventListener("keydown",function(t){e.handleKeydown(t)}),document.addEventListener("click",function(t){e.handleClickOutside(t)}),console.log("ProductSearch inicializado correctamente")};r.prototype.handleInput=function(e){var t=this,n=e.target.value.trim();clearTimeout(this.searchTimeout),n.length>=this.config.minSearchLength?this.searchTimeout=setTimeout(function(){t.searchProducts(n)},this.config.debounceTime):(this.hideResults(),this.resetSelection())};r.prototype.handleKeydown=function(e){var t=this.resultsContainer.querySelectorAll(".result-item");switch(e.key){case"ArrowDown":e.preventDefault(),t.length>0&&(this.currentSelectedIndex=Math.min(this.currentSelectedIndex+1,t.length-1),this.updateSelection(t));break;case"ArrowUp":e.preventDefault(),t.length>0&&(this.currentSelectedIndex=Math.max(this.currentSelectedIndex-1,-1),this.updateSelection(t));break;case"Enter":e.preventDefault(),this.currentSelectedIndex>=0&&this.currentSelectedIndex<this.availableProducts.length?this.selectProduct(this.availableProducts[this.currentSelectedIndex]):this.availableProducts.length===1&&this.selectProduct(this.availableProducts[0]);break;case"Escape":e.preventDefault(),this.hideResults(),this.resetSelection();break}};r.prototype.handleClickOutside=function(e){!this.searchInput.contains(e.target)&&!this.resultsContainer.contains(e.target)&&(this.hideResults(),this.resetSelection())};r.prototype.searchProducts=function(e){var t=this,n=this.config.searchUrl+"?q="+encodeURIComponent(e);fetch(n,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},credentials:"same-origin"}).then(function(s){return console.log("Response status:",s.status),s.ok?s.json():s.json().then(function(i){throw new Error("HTTP "+s.status+": "+(i.error||"Error desconocido"))}).catch(function(){throw new Error("HTTP "+s.status+": Error desconocido")})}).then(function(s){console.log("Search results:",s),s.results?t.displayResults(s.results):(console.error("No se encontró el campo results en la respuesta:",s),t.hideResults())}).catch(function(s){console.error("Error en búsqueda de productos:",s),t.showError(s.message)})};r.prototype.displayResults=function(e){if(this.resultsContainer.innerHTML="",this.availableProducts=e,this.resetSelection(),e.length===0){this.showNoResults();return}for(var t=0;t<e.length;t++){var n=this.createResultItem(e[t],t);this.resultsContainer.appendChild(n)}this.showResults()};r.prototype.createResultItem=function(e,t){var n=this,s=document.createElement("div");return s.className="result-item p-2 hover:bg-gray-100 cursor-pointer border-b border-gray-200",s.setAttribute("data-index",t),s.innerHTML='<div class="font-medium text-black">'+this.escapeHtml(e.name)+'</div><div class="text-sm text-gray-600">Precio: $'+parseFloat(e.price).toLocaleString("es-CO")+"</div>",s.addEventListener("click",function(){n.selectProduct(e)}),s.addEventListener("mouseenter",function(){n.currentSelectedIndex=t,n.updateSelection(n.resultsContainer.querySelectorAll(".result-item"))}),s};r.prototype.showNoResults=function(){var e=document.createElement("div");e.className="p-2 text-gray-500",e.textContent="No se encontraron productos",this.resultsContainer.appendChild(e),this.availableProducts=[],this.showResults()};r.prototype.showError=function(e){var t=this;this.resultsContainer.innerHTML="";var n=document.createElement("div");n.className="p-2 text-red-500",n.textContent="Error: "+e,this.resultsContainer.appendChild(n),this.showResults(),setTimeout(function(){t.hideResults()},3e3)};r.prototype.selectProduct=function(e){this.searchInput.value=e.name,this.selectedProductInput.value=e.id,this.hideResults(),this.resetSelection(),this.focusQuantityInput(),console.log("Producto seleccionado:",e.name,"ID:",e.id)};r.prototype.focusQuantityInput=function(){var e=document.querySelector('input[name="'+this.config.quantityInputName+'"]');e&&setTimeout(function(){e.focus()},100)};r.prototype.updateSelection=function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("bg-blue-100","bg-blue-200");if(this.currentSelectedIndex>=0&&this.currentSelectedIndex<e.length){var n=e[this.currentSelectedIndex];n.classList.add("bg-blue-100"),n.scrollIntoView({behavior:"smooth",block:"nearest"})}};r.prototype.resetSelection=function(){this.currentSelectedIndex=-1};r.prototype.showResults=function(){this.resultsContainer.classList.remove("hidden")};r.prototype.hideResults=function(){this.resultsContainer.classList.add("hidden")};r.prototype.escapeHtml=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(n){return t[n]})};r.prototype.getSelectedProduct=function(){return{id:this.selectedProductInput.value,name:this.searchInput.value}};r.prototype.clear=function(){this.searchInput.value="",this.selectedProductInput.value="",this.hideResults(),this.resetSelection(),this.availableProducts=[]};r.prototype.destroy=function(){this.searchTimeout&&clearTimeout(this.searchTimeout),console.log("ProductSearch destruido")};window.ProductSearch=r;console.log("Sistema conectado correctamente");
